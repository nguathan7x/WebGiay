@model List<WebGiayOnline.Areas.Admin.Controllers.UserRoleViewModel>

@{
    ViewData["Title"] = "Quản lý vai trò";
    Layout = "~/Areas/Admin/Views/Shared/_Layout1.cshtml";
}

@section Styles {
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            font-size: 1.05rem;
        }

        .form-select {
            min-width: 150px;
        }

        th, td {
            vertical-align: middle !important;
        }

        .btn-sm {
            font-size: 0.875rem;
            padding: 0.4rem 0.75rem;
        }

        .table td,
        .table th {
            text-align: center;
        }
    </style>
}

<div class="container mt-4">
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <h3 class="text-primary fw-bold mb-4">
                <i class="fas fa-users-cog me-2"></i> Quản lý vai trò người dùng
            </h3>

            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">@TempData["Error"]</div>
            }
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }

            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle shadow-sm">
                    <thead class="table-light">
                        <tr>
                            <th>Email</th>
                            <th>Vai trò</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model)
                        {
                            <tr>
                                <td class="text-start">@user.Email</td>
                                <td class="text-uppercase fw-semibold">@user.CurrentRole</td>
                                <td>
                                    @if (user.IsEnabled)
                                    {
                                        <span class="badge bg-success">Đang hoạt động</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">Vô hiệu hóa</span>
                                    }
                                </td>
                                <td>
                                    <div class="d-flex flex-column flex-md-row justify-content-center gap-2">
                                        <!-- Đổi vai trò -->
                                        <form asp-action="ChangeUserRole" method="post" class="d-flex align-items-center flex-wrap">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="userId" value="@user.UserId" />
                                            <select name="newRole" class="form-select form-select-sm me-2">
                                                @foreach (var role in ViewBag.AllRoles as List<string>)
                                                {
                                                    <option value="@role" selected="@(role == user.CurrentRole)">
                                                        @role
                                                    </option>
                                                }
                                            </select>
                                            <button type="submit" class="btn btn-outline-primary btn-sm">
                                                <i class="fas fa-user-tag me-1"></i> Cập nhật
                                            </button>
                                        </form>

                                        <!-- Bật/tắt tài khoản -->
                                        <form asp-action="ToggleUserStatus" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="userId" value="@user.UserId" />
                                            <button type="submit" class="btn btn-sm @(user.IsEnabled ? "btn-outline-danger" : "btn-outline-success")">
                                                <i class="fas @(user.IsEnabled ? "fa-user-slash" : "fa-user-check") me-1"></i>
                                                @(user.IsEnabled ? "Vô hiệu hóa" : "Kích hoạt")
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>